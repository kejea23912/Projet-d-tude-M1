---
title: "exemple de presentation"
author:
- "Kenny Jean-elie"
- Ibrahima Caba Bah
- Fatou Diop Ndeye
date: "`r Sys.Date()`"
output:
  beamer_presentation:
    slide_level: 2
    theme: Madrid
    colortheme: dolphin
    highlight: tango
  ioslides_presentation:
    highlight: tango
  slidy_presentation:
    highlight: tango
---

```{r, Importation des librairies , include=FALSE}
library(tidyverse)
library(FactoMineR)
library(factoextra)
library(Factoshiny)
library(kableExtra)
library(patchwork)
library(ggpubr)
```

```{r}
col_ind <- "#008EA0FF" #"#357EBDFF"
col_var <- "#C71000FF"#D43F3AFF"
col_bar <- "#8A419888"#5CB85CFF"
logodark <- "#5A9599EE"
corail <- "#FF6348FF"
orange <- "#FF6F00FF"
accent <- "#00817c"
alert <- "#e64173"
violet <- "#8A4198FF"
pal_js <- c(col_ind, "deeppink1", "seagreen2", orange, violet,  col_var)
```




```{r, Importaion de la base de données , include=FALSE}
dfbefore<-read.csv("basse_final.csv",sep = ",", dec = ".",header = TRUE)[,-1]
head(df)
```

```{r, traitement de la basse de donnée, include=FALSE}
#dans ce chunk on élimine les ligne qui posedent au moins un NA dans ces variables
sum(is.na(dfbefore))
df <- na.omit(dfbefore)

```



# Introduction

Bienvenue dans cette mini présentation Beamer avec R Markdown.

## Objectif

- Montrer une slide avec deux colonnes
- Combiner un graphique et un commentaire

## Slide avec deux colonnes

:::: columns
::: {.column width="50%"}
```{r, echo=FALSE}
plot(pressure, main = "Courbe de pression")
``` 
::: 

::: {.column width="50%"}
"Cette diapositive utilise deux colonnes. À gauche, nous avons un graphique représentant la relation entre la température et la pression. À droite, nous avons ce commentaire explicatif."
:::

::::





# ACP

## inertie 
```{r}
nrow(df)
length(unique(df$adresse))
length(unique(df$etiquette_dpe))
length(unique(df$numero_dpe))
```

# Analyse des Correspondances Factorielles
```{r, echo= FALSE}
res.CA<-CA(df[,-c(4,5)],quali.sup=c(4,5),quanti.sup=c(1,3,6,11),graph=FALSE)

fviz_ca(res.CA,
        col.quali.sup = "#FF00FF",
        repel = TRUE,
        label = c("var","quali")) +
  theme_minimal() +                # thème épuré
  theme(plot.title = element_text(size=16, face="bold", color="darkblue", a=0.1),
        axis.title = element_text(size=14, face="italic"),
        legend.position = "bottom")


```





## Présentation générale de l'ACF



##  Description des variables

### Variables actives: 
Étiquette_dpe, Étiquette_ges, Année_construction, Nombre_appartement


### Variables quantitatives supplémentaires:
Consommation.annuelle...., Surface_habitable, Émission_ges_5_usages, Coût_total_5_usages

### variable exclue:
Adresse, Numero_dpe, Conso_5_usages_ef, Consommation.annuelle.moyenne....


## Qualité globale de l'ACF

## interprétation de l'axe 1 

## interprétation de l'axe 2

## Analyse des individus

## synthèse finale






# ACM 

```{r}
df2 <-df %>% 
  rename(Conso_totale = Consommation.annuelle.totale.de.l.adresse..MWh., Conso_Moy_log = Consommation.annuelle.moyenne.par.logement.de.l.adresse..MWh.,Conso_com = Consommation.annuelle.moyenne.de.la.commune..MWh. ) %>% 
  select(-adresse, -numero_dpe)

str(df2)
```
## Conversion des variables qualitatives en factor et decoupage en classe
```{r}
qualitative_cols<-c("etiquette_dpe","etiquette_ges")
df2[qualitative_cols]<-lapply(df2[qualitative_cols], as.factor)
quantitative_cols<-c("Conso_totale","Conso_Moy_log","Conso_com","annee_construction","surface_habitable_logement","conso_5.usages_ef","emission_ges_5_usages","cout_total_5_usages","nombre_appartement")
df2[quantitative_cols] <- lapply(df2[quantitative_cols], function(x) {
  cut(x,
      breaks = unique(quantile(x, probs = seq(0, 1, 0.25), na.rm = TRUE)),
      include.lowest = TRUE
  )
})
str(df2)

```
```{r}
quali.sup = c(4,5)
```

## Mise en Oeuvre de l'ACM

```{r}
ACM<-MCA(df2, quali.sup = quali.sup, graph = F, ncp = Inf)
```
### Inertie
```{r}
ACM$eig
```

### Graphique des Inerties 
```{r}
fviz_eig(ACM)
```



#

```{r}
Factoshiny(df2)
```







# Mise en Oeuvre de la clasification non supervisée à partir de l'ACM
On commence par faire par faire une classification hierarchique ascendante sur la sortie de l'ACM avec consolidation puis faire la méthodes **k-means** 
```{r}
res.HCPC<-HCPC(ACM,nb.clust=4,consol=FALSE,graph=FALSE)
plot.HCPC(res.HCPC,choice='tree',title='Arbre hiérarc hique')
plot.HCPC(res.HCPC,choice='map',draw.tree=FALSE,title='Plan factoriel')

```



```{r}
fviz_nbclust(ACM$ind$coord, hcut, method = "silhouette",
                  barfill = col_ind,
                  barcolor = col_ind,
                  linecolor = col_ind,
                  maxSE = list("Tibs2001SEmax"))
```



```{r}
k <- 20


res.HCPC$call$t$inert.gain[1:k] |> data.frame(inert_gain = _) |>
  ggplot() + aes(x= 1:k,y= inert_gain) + geom_bar(stat = "identity", alpha = 0.8) +
  labs(title = "Between inertia gain", x="") 

```


```{r}
res.HCPC_consol<-HCPC(res.MCA,nb.clust= 3,consol=TRUE,graph=FALSE)
res.HCPC2<- HCPC(res.MCA,nb.clust=3,consol=FALSE,graph=FALSE)
plot.HCPC(res.HCPC2,choice='tree',title='Arbre hiérarc hique 2')
plot.HCPC(res.HCPC2,choice='map',draw.tree=FALSE,title='Plan factoriel')
```

```{r}
fviz_cluster(res.HCPC2, geom = "point", ellipse = FALSE, show.clust.cent = FALSE, alpha = 0.8 , ggtheme = theme_minimal())+labs(title = "cluster visualization")+theme(legend.position = "bottom")
```
```{r}
fviz_cluster(res.HCPC2, geom="point", ellipse = TRUE, show.clust.cent = FALSE, ggtheme = theme_minimal()) +
 labs(title= "Cluster visualization")+
 theme(legend.position = "none") +
fviz_cluster(res.HCPC2, geom="point", ellipse = TRUE, show.clust.cent = FALSE, axes = c(3,4), ggtheme = theme_minimal()) +
 labs(title= "Cluster visualization") +
 theme(legend.position = "none")
```
## Avec consolidation
Dimension 1 et 2
```{r}
(fviz_cluster(res.HCPC2, geom="point", ellipse = FALSE, show.clust.cent = FALSE,
               ggtheme = theme_minimal()) +
    labs(title= "HC without consolidation")+
    theme(legend.position = "none") +
  fviz_cluster(res.HCPC_consol, geom="point", ellipse = FALSE, show.clust.cent = FALSE,
               ggtheme = theme_minimal()) +
    labs(title= "HC with consolidation")+
    theme(legend.position = "none"))
```
```{r}
f1 <- fviz_cluster(res.HCPC2, geom = 'point', ellipse = T, axes = c(1,2),
                   ggtheme = theme_minimal()) +
  labs(title= "Visualisation des clusters sans consolidation") +
  theme(legend.position = "none")

f2 <- fviz_cluster(res.HCPC_consol, geom = 'point', ellipse = T, axes = c(1,2),
                 ggtheme = theme_minimal()) +
  labs(title= "Visualisation des clusters avec consolidation") +
  theme(legend.position = "none")
ggarrange(f1,f2)
```


## Dimension 3 et 4 
```{r}
f1 <- fviz_cluster(res.HCPC2, geom = 'point', ellipse = T, axes = c(3,4),
                   ggtheme = theme_minimal()) +
  labs(title= "Visualisation des clusters sans consolidation") +
  theme(legend.position = "none")

f2 <- fviz_cluster(res.HCPC_consol, geom = 'point', ellipse = T, axes = c(1,2),
                 ggtheme = theme_minimal()) +
  labs(title= "Visualisation des clusters avec consolidation") +
  theme(legend.position = "none")
ggarrange(f1,f2)
```



### Paragons

```{r}
para<-res.HCPC_consol$desc.ind$para
dist<-res.HCPC_consol$desc.ind$dist
par1 <- names(para[[1]])
par2 <- names(para[[2]])
par3 <- names(para[[3]])

dist1 <- names(dist[[1]])
dist2 <- names(dist[[2]])
dist3 <- names(dist[[3]])


```




```{r}
df[c(par1, par2, par3),] |>
  select(-adresse, -numero_dpe) |>
  kable() |>
  kable_styling(
    full_width = FALSE,
    position = "center", font_size = 16,
    bootstrap_options = c("striped", "hover", "condensed")
  )  |> pack_rows(
  "Cluster 1", 1, length(par1)
) |> pack_rows(
  "Cluster 2", length(par1) +1 , length(par1) + length(par2)
) |> pack_rows(
  "Cluster 3", length(par1)+ length(par2)  +1 , length(par1) + length(par2) + length(par3)
) 
```

```{r}
df[c(dist1, dist2,dist3),] |>
  select(-adresse, -numero_dpe) |>
  kable() |>
  kable_styling(
    full_width = FALSE,
    position = "center", font_size = 16,
    bootstrap_options = c("striped", "hover", "condensed")
  )  |>
  pack_rows(
    "Cluster 1", 1, length(dist1)
  )  |> pack_rows(
  "Cluster 2", length(dist1) +1 , length(dist1) + length(dist2)
) |> pack_rows(
  "Cluster 3", length(dist1)+ length(dist2)  +1 , length(dist1) + length(dist2) + length(dist3)
) 
```

```{r}
options(scipen = 0)
res.HCPC_consol$desc.var$test.chi2 %>% 
  as.data.frame() %>% 
  kable(digits = 200) %>% 
  kable_styling(font_size = 16)
  


```

```{r}
res.HCPC_consol$desc.var$category$`1`%>% 
  kable(digits = c(1,1,1,200,2)) %>% 
  kable_styling(font_size = 16)
```

```{r}
res.HCPC_consol$desc.var$category$`2` %>% 
  kable(digits = c(1,1,1,200,2)) %>% 
  kable_styling(font_size = 16)
```


```{r}
res.HCPC_consol$desc.var$category$`3` %>% 
  kable(digits = c(1,1,1,200,2)) %>% 
  kable_styling(font_size = 16)
```



