---
title: "exemple de presentation"
author:
- "Kenny Jean-elie"
- Ibrahima Caba Bah
- Fatou Diop Ndeye
date: "`r Sys.Date()`"
output:
  ioslides_presentation:
    highlight: tango
  slidy_presentation:
    highlight: tango
  beamer_presentation:
    slide_level: 2
    theme: Madrid
    colortheme: dolphin
    highlight: tango
---

```{r setup,include = FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE)
```

```{r, Importation des librairies , include=FALSE}
library(tidyverse)
library(FactoMineR)
library(factoextra)
library(Factoshiny)
library(kableExtra)

```


```{r, Importaion de la base de données , include=FALSE}
dfbefore<-read.csv("basse_final.csv",sep = ",", dec = ".",header = TRUE)[,-1]
head(df)
```

```{r, traitement de la basse de donnée, include=FALSE}
#dans ce chunk on élimine les ligne qui posedent au moins un NA dans ces variables
sum(is.na(dfbefore))
df <- na.omit(dfbefore)

```





# Introduction

Bienvenue dans cette mini présentation Beamer avec R Markdown.

## Objectif

- Montrer une slide avec deux colonnes
- Combiner un graphique et un commentaire

## Slide avec deux colonnes

:::: columns
::: {.column width="50%"}
```{r, echo=FALSE}
plot(pressure, main = "Courbe de pression")
``` 
::: 

::: {.column width="50%"}
"Cette diapositive utilise deux colonnes. À gauche, nous avons un graphique représentant la relation entre la température et la pression. À droite, nous avons ce commentaire explicatif."
:::

::::





# ACP

## inertie 
```{r}
nrow(df)
length(unique(df$adresse))
length(unique(df$etiquette_dpe))
length(unique(df$numero_dpe))
```

# Analyse des Correspondances Factorielles
```{r, echo= FALSE}
Tab <- table(df$etiquette_dpe, df$etiquette_ges)
res.CA <- CA(Tab, graph= FALSE)

fviz_ca(res.CA, repel = TRUE ) +
  theme_minimal() +
  theme()


```



## Présentation générale de l'ACF

```{r}
pourcent <- function(x){x*100}
restest <- chisq.test(Tab)
Tabresult <- c(paste("$\\chi^2_{obs}=$",round(restest$statistic, 2)),
               paste("df =", restest$parameter),
               paste("$\\test{p_value} =",round(restest$p.value,6)
))
kable(Tabresult, col.names = "Resultat test") |>  kable_minimal(full_width = F)
```


##  Description des variables

### Variables actives: 
Étiquette_dpe, Étiquette_ges

pour quoi? 

## Qualité globale de l'ACF

:::: columns
::: {.column width="50%"}
```{r, echo=FALSE}
fviz_screeplot(res.CA, addlabels =TRUE, barfill = "blue")
``` 
::: 

::: {.column width="50%"}

L'Axe 1 et 2 cumulent `r round;(res.CA$eig[2,3],1)` % de l'inertie total

:::

::::

## interprétation de l'axe 1 

```{r}
fig1 <- fviz_contrib(res.CA, choice = "row", axes = 1) +
  ggtitle("Contribution des DPE à la Dime 1") +
  theme_minimal()

fig2 <- fviz_contrib(res.CA, choice = "col", axes = 1) +
  ggtitle("Contribution des GES à la Dim1") +
  theme_minimal() 


ggarrange(fig1, fig2, ncol = 2)

```


## interprétation de l'axe 2

```{r}
fig1 <- fviz_contrib(res.CA, choice = "row", axes = 2) +
  ggtitle("Contribution des DPE à la Dime 2") +
  theme_minimal()

fig2 <- fviz_contrib(res.CA, choice = "col", axes = 2) +
  ggtitle("Contribution des GES à la Dim2") +
  theme_minimal() 


ggarrange(fig1, fig2, ncol = 2)

```


## synthèse finale






# ACM 

```{r}
df2 <-df %>% 
  rename(Conso_totale = Consommation.annuelle.totale.de.l.adresse..MWh., Conso_Moy_log = Consommation.annuelle.moyenne.par.logement.de.l.adresse..MWh.,Conso_com = Consommation.annuelle.moyenne.de.la.commune..MWh. ) %>% 
  select(-adresse, -numero_dpe)

str(df2)
```
## Conversion des variables qualitatives en factor et decoupage en classe
```{r}
qualitative_cols<-c("etiquette_dpe","etiquette_ges")
df2[qualitative_cols]<-lapply(df2[qualitative_cols], as.factor)
quantitative_cols<-c("Conso_totale","Conso_Moy_log","Conso_com","annee_construction","surface_habitable_logement","conso_5.usages_ef","emission_ges_5_usages","cout_total_5_usages","nombre_appartement")
df2[quantitative_cols] <- lapply(df2[quantitative_cols], function(x) {
  cut(x,
      breaks = unique(quantile(x, probs = seq(0, 1, 0.25), na.rm = TRUE)),
      include.lowest = TRUE
  )
})
str(df2)

```
```{r}
quali.sup = c(4,5)
```

## Mise en Oeuvre de l'ACM

```{r}
ACM<-MCA(df2, quali.sup = quali.sup, graph = F, ncp = Inf)
```
### Inertie
```{r}
ACM$eig
```

### Graphique des Inerties 
```{r}
fviz_eig(ACM)
```



#








# Mise en Oeuvre de la clasification non supervisée à partir de l'ACM
On commence par faire par faire une classification hierarchique ascendante sur la sortie de l'ACM avec consolidation puis faire la méthodes **k-means** 
```{r}
ACM_HCPC<-HCPC(ACM, graph = F, consol = F, cex = 0.3)
```

```{r}
#fviz_dend(ACM_HCPC, main = "cluster with Ward method")
```



## reste 